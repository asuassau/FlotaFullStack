<ion-header [translucent]="true">
  <ion-toolbar class="app-toolbar">
    <ion-title class="page-title">Ficha de Conductor</ion-title>
    <ion-buttons slot="end">
      <ion-button class="icon-btn" (click)="goBack()">
        <ion-icon name="arrow-back-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="page-bg">
  <div class="page-wrap">

    <div class="glass-card">
      <div class="card-head">
        <h1 class="card-title">Formulario de conductor</h1>
        <p class="card-subtitle">Actualiza datos, credenciales y fotografía</p>
      </div>

      <!-- Bloque foto + acciones -->
      <ion-grid class="photo-grid">
        <ion-row class="ion-align-items-center">
          <ion-col size="12" size-md="6">
            <div class="photo-box" (click)="takePhoto()">
              <ion-img
                *ngIf="capturedPhoto"
                class="photo-frame"
                [src]="capturedPhoto">
              </ion-img>

              <ion-img
                *ngIf="!capturedPhoto"
                class="photo-frame placeholder"
                src="../../assets/No-Image-Placeholder.svg">
              </ion-img>

              <div class="photo-hint">
                <ion-icon name="camera-outline"></ion-icon>
                <span>Toca para cambiar</span>
              </div>
            </div>
          </ion-col>

          <ion-col size="12" size-md="6">
            <div class="photo-actions">
              <ion-button class="action-btn" fill="outline" (click)="takePhoto()">
                <ion-icon slot="start" name="camera-outline"></ion-icon>
                Take a photo
              </ion-button>

              <ion-button class="action-btn" fill="outline" (click)="pickImage()">
                <ion-icon slot="start" name="image-outline"></ion-icon>
                Pick an image
              </ion-button>

              <ion-button class="action-btn danger" fill="outline" (click)="discardImage()">
                <ion-icon slot="start" name="aperture"></ion-icon>
                Discard image
              </ion-button>
            </div>
          </ion-col>
        </ion-row>
      </ion-grid>
    </div>

    <!-- Formulario -->
    <form class="glass-card form-card" [formGroup]="conductorForm" (ngSubmit)="guardar()">

      <ion-item class="input-item" lines="none">
        <ion-label position="floating">Nombre</ion-label>
        <ion-input formControlName="name" type="text"></ion-input>
      </ion-item>

      <ion-note class="error-note"
        *ngIf="getFormControl('name')?.hasError('required') && getFormControl('name')?.touched">
        El nombre es obligatorio
      </ion-note>

      <ion-item class="input-item" lines="none">
        <ion-label position="floating">Apellidos</ion-label>
        <ion-input formControlName="surname" type="text"></ion-input>
      </ion-item>

      <ion-item class="input-item" lines="none">
        <ion-label position="floating">Usuario</ion-label>
        <ion-input formControlName="username" type="text"></ion-input>
      </ion-item>

      <ion-item class="input-item" lines="none">
        <ion-label position="floating">Contraseña</ion-label>
        <ion-input formControlName="password" type="password"></ion-input>
      </ion-item>

      <!-- Admin checkbox -->
      <ion-item class="input-item checkbox-item" lines="none">
        <ion-label>Administrador</ion-label>
        <ion-checkbox
          slot="end"
          [checked]="conductorForm.value.isAdmin == 1"
          (ionChange)="conductorForm.patchValue({ isAdmin: $event.detail.checked ? 1 : 0 })">
        </ion-checkbox>
      </ion-item>

      <ion-button class="primary-btn" expand="block" type="submit" [disabled]="!conductorForm.valid">
        Guardar
      </ion-button>
    </form>

  </div>
</ion-content>
